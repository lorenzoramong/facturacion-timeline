<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CAMINO GDC</title>
 
<style>
  body {
    margin: 0;
    font-family: "Inter", sans-serif;
    background: #fff;
    color: #222;
  }
 
  /* Encabezado */
  .hero {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 60px 20px 40px;
    gap: 20px;
    background: linear-gradient(135deg, #eaf6ff, #d3f7e4);
    border-bottom: 1px solid #e3eaf0;
  }
 
  .hero-logo {
    width: 95px;
    height: 95px;
    object-fit: contain;
    animation: float 3s ease-in-out infinite;
  }
 
  @keyframes float {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
 
  .hero-text h1 {
    font-size: 2.4rem;
    font-weight: 700;
    margin: 0;
    color: #0072bb;
  }
 
  .hero-text p {
    margin: 8px 0 0;
    color: #444;
  }
 
  /* Filtros */
  .filters {
    display: flex;
    flex-direction: column;
    position: fixed;
    left: 20px;
    top: 300px;
    gap: 10px;
    background: #ffffffd0;
    backdrop-filter: blur(8px);
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    z-index: 5;
  }
 
  select, input {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
 
  /* L√≠nea de a√±os */
  .main-timeline {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 90px;
    margin: 70px auto;
    padding: 10px;
    max-width: 1100px;
    position: relative;
  }
 
  .main-timeline::before {
    content: "";
    position: absolute;
    top: 58%; /* CORREGIDO PARA QUE LA L√çNEA BAJE */
    left: 5%;
    right: 5%;
    height: 4px;
    background: linear-gradient(90deg, #0072bb, #7cc242);
    z-index: 0;
  }
 
  .year-node {
    background: #fff;
    border: 4px solid #0072bb;
    border-radius: 50%;
    width: 75px;
    height: 75px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    cursor: pointer;
    transition: .25s;
    z-index: 2; /* ENCIMA DE LA L√çNEA */
  }
 
  .year-node.active {
    background: #7cc242;
    color: #fff;
    border-color: #7cc242;
  }
 
  .year-node:hover {
    transform: scale(1.1);
    background: #0072bb;
    color: #fff;
  }
 
  /* Detalle a√±o */
  .year-details {
    display: none;
    flex-direction: column;
    align-items: center;
    margin-top: 40px;
  }
 
  .year-details.active {
    display: flex;
    animation: fadeIn .5s;
  }
 
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
 
  .events-line {
    width: 3px;
    background: #0072bb55;
    height: 100%;
    margin-bottom: 20px;
  }
 
  .event {
    width: 300px;
    padding: 16px;
    background: #f9f9f9;
    margin: 20px 0;
    border-left: 6px solid #0072bb;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 5px 12px rgba(0,0,0,.06);
    transition: .25s;
  }
 
  .event:hover {
    transform: translateY(-4px);
  }
 
  .event .date {
    color: #7cc242;
    font-weight: 600;
  }
 
  /* Bot√≥n flotante + */
  #openPanelBtn {
    position: fixed;
    top: 25px;
    right: 25px;
    width: 52px;
    height: 52px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    color: white;
    font-size: 28px;
    font-weight: 600;
    background: linear-gradient(135deg, #0072bb, #7cc242);
    box-shadow: 0 4px 10px rgba(0,0,0,0.20);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: transform .15s ease, box-shadow .15s ease;
    z-index: 999;
  }
 
  #openPanelBtn:hover {
    transform: scale(1.09);
    box-shadow: 0 6px 14px rgba(0,0,0,0.25);
  }
 
  /* Panel lateral */
  #sidePanel {
    position: fixed;
    right: -400px;
    top: 0;
    width: 340px;
    height: 100vh;
    background: #ffffffee;
    backdrop-filter: blur(6px);
    box-shadow: -3px 0 10px rgba(0,0,0,.1);
    padding: 20px;
    transition: .4s;
    z-index: 1000;
  }
 
  #sidePanel.open {
    right: 0;
  }
 
  #sidePanel h2 {
    color: #0072bb;
    margin-bottom: 10px;
  }
 
  #sidePanel input,
  #sidePanel textarea,
  #sidePanel select {
    width: 100%;
    margin-bottom: 12px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
 
  #sidePanel button {
    width: 100%;
    padding: 12px;
    background: #0072bb;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 8px;
  }
 
  /* X para cerrar panel */
  #closePanel {
    position: absolute;
    top: 12px;
    right: 15px;
    font-size: 22px;
    cursor: pointer;
    color: #0072bb;
    font-weight: 600;
  }
 
  /* Modal */
  #modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width:100%; height:100%;
    background: rgba(0,0,0,.5);
    justify-content: center;
    align-items: center;
    z-index: 2000;
  }
 
  #modalContent {
    width: 360px;
    background: white;
    padding: 22px;
    border-radius: 12px;
  }
</style>
</head>
 
<body>
 
<!-- Encabezado -->
<header class="hero">
<img src="logo-gases.png" class="hero-logo">
<div class="hero-text">
<h1>CAMINO GDC</h1>
<p>Explor√° los hitos m√°s importantes por a√±o</p>
</div>
</header>
 
<!-- Filtros -->
<div class="filters">
 
  <select id="filterType">
<option value="">Tipo</option>
<option value="implementaci√≥n">Implementaci√≥n</option>
<option value="incidente">Incidente</option>
<option value="mejora">Mejora</option>
</select>
 
  <select id="filterImpact">
<option value="">Impacto</option>
<option value="alto">Alto</option>
<option value="medio">Medio</option>
<option value="bajo">Bajo</option>
</select>
 
  <input id="filterKeyword" placeholder="Buscar..." />
</div>
 
<!-- L√≠nea de tiempo -->
<section class="main-timeline" id="timeline"></section>
 
<!-- Contenedores din√°micos -->
<div id="yearDetailContainer"></div>
 
<!-- Bot√≥n flotante -->
<button id="openPanelBtn">+</button>
 
<!-- Panel lateral -->
<div id="sidePanel">
<h2>Crear Hito</h2>
 
  <div id="closePanel">‚úñ</div>
 
  <input id="dateInput" type="date" />
 
  <input id="titleInput" placeholder="T√≠tulo" />
 
  <input id="detailInput" placeholder="Detalle breve (8 palabras)" />
 
  <textarea id="descriptionInput" placeholder="Descripci√≥n"></textarea>
 
  <select id="typeInput">
<option value="">Tipo</option>
<option value="Implementaci√≥n">Implementaci√≥n</option>
<option value="Incidente">Incidente</option>
<option value="Mejora">Mejora</option>
</select>
 
  <select id="impactInput">
<option value="">Impacto</option>
<option value="Alto">Alto</option>
<option value="Medio">Medio</option>
<option value="Bajo">Bajo</option>
</select>
 
  <input id="authorInput" placeholder="Autor" />
 
  <button id="submitHito">Guardar Hito</button>
</div>
 
<!-- Modal -->
<div id="modal">
<div id="modalContent">
<h2 id="modalTitle"></h2>
<p id="modalDate"></p>
<p id="modalDesc"></p>
<p id="modalExtra"></p>
</div>
</div>

 <!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
 
<script>
  /* üî• CONFIG DE FIREBASE */
  const firebaseConfig = {
    apiKey: "AIzaSyABOt5v_tBFjXttFlogHPnOY9l_T_a7g0c",
    authDomain: "camino-gdc.firebaseapp.com",
    projectId: "camino-gdc",
    storageBucket: "camino-gdc.firebasestorage.app",
    messagingSenderId: "1053392006260",
    appId: "1:1053392006260:web:8c39450408566f14987521"
  };
 
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
 
  auth.onAuthStateChanged(user => {
    if (!user) window.location.href = "login.html";
  });
</script>
 
<!-- L√ìGICA PRINCIPAL -->
<script>
  /* CONFIG GOOGLE SHEETS / APPS SCRIPT */
  const SHEET_ID   = "13SfGnF5EZduKG6_NjeCWPeY63uR48yEfvVTyGF6j_bA";
  const API_KEY    = "AIzaSyDI7q9YVBaK24yBQtP08SU4uOJiFsXmMaQ";
  const SHEET_NAME = "Hitos";
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyjthogZdAEo1Irk_Dy8cgiJyG2o4YHgdzf2hC5a-3V1A7VZOMemGa4ilvNWcp_-gSX/exec";
 
  /* REFERENCIAS DOM */
  const timeline            = document.getElementById("timeline");
  const yearDetailContainer = document.getElementById("yearDetailContainer");
 
  const filterType    = document.getElementById("filterType");
  const filterImpact  = document.getElementById("filterImpact");
  const filterKeyword = document.getElementById("filterKeyword");
 
  const openPanelBtn = document.getElementById("openPanelBtn");
  const sidePanel    = document.getElementById("sidePanel");
  const closePanel   = document.getElementById("closePanel");
  const submitHito   = document.getElementById("submitHito");
 
  /* MODAL */
  const modal      = document.getElementById("modal");
  const modalTitle = document.getElementById("modalTitle");
  const modalDate  = document.getElementById("modalDate");
  const modalDesc  = document.getElementById("modalDesc");
  const modalExtra = document.getElementById("modalExtra");
 
  /* ============================
     1. Construir a√±os din√°micos
  ============================ */
  async function construirAnios() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();
    if (!data.values) return;
 
    const rows = data.values.slice(1); // quitar encabezados
    const yearsSet = new Set();
 
    rows.forEach(r => {
      const fecha = r[0];
      if (!fecha) return;
      const year = new Date(fecha).getFullYear();
      if (!isNaN(year)) yearsSet.add(year);
    });
 
    const years = Array.from(yearsSet).sort((a, b) => a - b);
 
    timeline.innerHTML = "";
    yearDetailContainer.innerHTML = "";
 
    years.forEach(year => {
      // Nodo de a√±o
      const node = document.createElement("div");
      node.className = "year-node";
      node.dataset.year = year;
      node.textContent = year;
      timeline.appendChild(node);
 
      // Contenedor de eventos del a√±o
      const section = document.createElement("section");
      section.className = "year-details";
      section.id = `details-${year}`;
      section.innerHTML = `<div class="events-line"></div>`;
      yearDetailContainer.appendChild(section);
    });
 
    activarClicksAnios();
    cargarHitos();
  }
 
  /* ============================
     2. Activar click en a√±os
  ============================ */
  function activarClicksAnios() {
    const nodes   = document.querySelectorAll(".year-node");
    const details = document.querySelectorAll(".year-details");
 
    nodes.forEach(node => {
      node.onclick = () => {
        nodes.forEach(n => n.classList.remove("active"));
        details.forEach(d => d.classList.remove("active"));
 
        node.classList.add("active");
        const target = document.getElementById(`details-${node.dataset.year}`);
        if (target) target.classList.add("active");
      };
    });
  }
 
  /* ============================
     3. Cargar hitos desde Sheets
  ============================ */
  async function cargarHitos() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();
    if (!data.values) return;
 
    const rows = data.values.slice(1);
 
    rows.forEach(r => {
      const [fecha, titulo, detalle, descripcion, tipo, impacto, autor] = r;
 
      if (!fecha || !titulo) return;
 
      const year = new Date(fecha).getFullYear();
      const cont = document.getElementById(`details-${year}`);
      if (!cont) return;
 
      const tipoLower    = (tipo || "").toLowerCase();
      const impactoLower = (impacto || "").toLowerCase();
      const searchText   = `
        ${fecha} ${titulo} ${detalle} ${descripcion} ${tipo} ${impacto} ${autor}
      `.toLowerCase();
 
      const el = document.createElement("div");
      el.className = "event";
 
      el.dataset.type   = tipoLower;
      el.dataset.impact = impactoLower;
      el.dataset.key    = searchText;
 
      el.innerHTML = `
<div class="date">${fecha}</div>
<h3>${titulo}</h3>
<p>${detalle || ""}</p>
      `;
 
      el.onclick = () =>
        abrirModal(titulo, fecha, descripcion, tipo, impacto, autor);
 
      cont.appendChild(el);
    });
 
    aplicarFiltros(); // aplicar filtros iniciales (por si hay algo)
  }
 
  /* ============================
     4. Modal de detalle
  ============================ */
  function abrirModal(t, f, d, tipo, impacto, autor) {
    modalTitle.textContent = t;
    modalDate.textContent  = f;
    modalDesc.textContent  = d || "";
    modalExtra.innerHTML   = `
<b>Tipo:</b> ${tipo || ""}<br>
<b>Impacto:</b> ${impacto || ""}<br>
<b>Autor:</b> ${autor || ""}<br>
    `;
 
    modal.style.display = "flex";
  }
 
  modal.onclick = e => {
    if (e.target === modal) modal.style.display = "none";
  };
 
  document.addEventListener("keydown", e => {
    if (e.key === "Escape") {
      modal.style.display = "none";
      sidePanel.classList.remove("open");
    }
  });
 
  /* ============================
     5. Filtros (tipo + impacto + texto)
  ============================ */
  function aplicarFiltros() {
    const typeFilter   = (filterType.value   || "").toLowerCase();
    const impactFilter = (filterImpact.value || "").toLowerCase();
    const textFilter   = (filterKeyword.value || "").toLowerCase();
 
    const eventos = document.querySelectorAll(".event");
 
    eventos.forEach(ev => {
      const tipoEv    = ev.dataset.type   || "";
      const impactEv  = ev.dataset.impact || "";
      const searchEv  = ev.dataset.key    || "";
 
      const coincideTipo   = !typeFilter   || tipoEv === typeFilter;
      const coincideImpact = !impactFilter || impactEv === impactFilter;
      const coincideTexto  = !textFilter   || searchEv.includes(textFilter);
 
      ev.style.display = (coincideTipo && coincideImpact && coincideTexto)
        ? "block"
        : "none";
    });
  }
 
  filterType.onchange    = aplicarFiltros;
  filterImpact.onchange  = aplicarFiltros;
  filterKeyword.oninput  = aplicarFiltros;
 
  /* ============================
     6. Panel lateral (+ y ‚úñ)
  ============================ */
  openPanelBtn.onclick = () => {
    sidePanel.classList.add("open");
  };
 
  closePanel.onclick = () => {
    sidePanel.classList.remove("open");
  };
 
  /* ============================
     7. Guardar hito en Apps Script
  ============================ */
  submitHito.onclick = async () => {
    const fecha       = document.getElementById("dateInput").value;
    const titulo      = document.getElementById("titleInput").value;
    const detalle     = document.getElementById("detailInput").value;
    const descripcion = document.getElementById("descriptionInput").value;
    const tipo        = document.getElementById("typeInput").value;
    const impacto     = document.getElementById("impactInput").value;
    const autor       = document.getElementById("authorInput").value;
 
    if (!fecha || !titulo) {
      alert("La fecha y el t√≠tulo son obligatorios.");
      return;
    }
 
    const payload = {
      fecha,
      titulo,
      detalle,
      descripcion,
      tipo,
      impacto,
      autor
    };
 
    try {
      const res = await fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(payload)
      });
 
      if (!res.ok) throw new Error("No se pudo guardar el hito");
 
      alert("Hito guardado ‚úî");
      location.reload();
    } catch (err) {
      console.error(err);
      alert("Error al guardar el hito.");
    }
  };
 
  /* ============================
     8. Inicializaci√≥n
  ============================ */
  window.onload = construirAnios;
</script>
 
</body>
</html>
