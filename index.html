<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CAMINO GDC</title>
 
<!-- PWA: manifest + tema + favicon -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0072bb" />
<link rel="icon" href="icons/logo-192.png" />
<link rel="apple-touch-icon" href="icons/logo-512.png" />
 
<style>
body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: #fff;
  color: #222;
}
 
/* Bot√≥n descarga: que NO quede por encima del panel lateral */
#downloadReportBtn {
  z-index: 800; /* el panel tiene 1000, as√≠ que el panel lo tapa */
}
 
/* Encabezado */
.hero {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 60px 20px 40px;
  gap: 20px;
  background: linear-gradient(135deg, #eaf6ff, #d3f7e4);
  border-bottom: 1px solid #e3eaf0;
}
.hero-logo {
  width: 95px;
  height: 95px;
  object-fit: contain;
  animation: float 3s ease-in-out infinite;
}
@keyframes float {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}
.hero-text h1 {
  font-size: 2.4rem;
  font-weight: 700;
  margin: 0;
  color: #0072bb;
}
.hero-text p {
  margin: 8px 0 0;
  color: #444;
}
/* Bot√≥n logout */
.logout-btn {
  position: fixed;
  top: 22px;
  left: 22px;
  padding: 10px 18px;
  font-size: 15px;
  font-weight: 600;
  color: white;
  background: linear-gradient(135deg, #0072bb, #7cc242);
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.18);
  transition: all 0.2s ease;
  z-index: 1200;
  backdrop-filter: blur(4px);
}
.logout-btn:hover {
  transform: translateY(-2px) scale(1.04);
  box-shadow: 0 6px 16px rgba(0,0,0,0.22);
}
/* FILTROS ‚Äî NUEVO SISTEMA (hamburguesa) */
#filterMenuBtn {
  position: fixed;
  left: 20px;
  top: 160px;
  background: #0072bb;
  color: white;
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,.15);
  z-index: 1600;
  border: none;
}
 
#filtersPanel {
  position: fixed;
  left: -260px;
  top: 0;
  width: 240px;
  height: 100vh;
  background: #ffffffee;
  backdrop-filter: blur(6px);
  padding: 20px;
  box-shadow: 4px 0 12px rgba(0,0,0,.15);
  transition: .3s;
  z-index: 1500;
}
 
#filtersPanel.open {
  transform: translateX(260px); /* se desplaza suavemente */
  left: 0;
}
#filtersPanel h3 {
  margin-top: 0;
}
 
#filtersPanel select,
#filtersPanel input {
  width: 100%;
  margin-bottom: 12px;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #bbb;
}
/* L√≠nea de a√±os */
.main-timeline {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 90px;
  margin: 70px auto;
  padding: 10px;
  max-width: 1100px;
  position: relative;
}
.main-timeline::before {
  content: "";
  position: absolute;
  top: 58%;
  left: 5%;
  right: 5%;
  height: 4px;
  background: linear-gradient(90deg, #0072bb, #7cc242);
  z-index: 0;
}
.year-node {
  background: #fff;
  border: 4px solid #0072bb;
  border-radius: 50%;
  width: 75px;
  height: 75px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  cursor: pointer;
  transition: .25s;
  z-index: 2;
}
.year-node.active {
  background: #7cc242;
  color: #fff;
  border-color: #7cc242;
}
.year-node:hover {
  transform: scale(1.1);
  background: #0072bb;
  color: #fff;
}
/* Detalle a√±o */
.year-details {
  display: none;
  flex-direction: column;
  align-items: center;
  margin-top: 40px;
}
.year-details.active {
  display: flex;
  animation: fadeIn .5s;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
.events-line {
  width: 3px;
  background: #0072bb55;
  height: 100%;
  margin-bottom: 20px;
}
.event {
  width: 300px;
  padding: 16px;
  background: #f9f9f9;
  margin: 20px 0;
  border-left: 6px solid #0072bb;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 5px 12px rgba(0,0,0,.06);
  transition: .25s;
  position: relative;
}
.event:hover { transform: translateY(-4px); }
.event .date {
  color: #7cc242;
  font-weight: 600;
}
/* Controles admin */
.admin-tools {
  display: flex;
  gap: 6px;
  margin-top: 10px;
  justify-content: flex-end;
}
.icon-btn {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: transform 0.15s ease;
  opacity: 0.9;
}
.icon-btn:hover {
  transform: translateY(-1px);
  opacity: 1;
}
.icon-edit { background: #0072bb; color:white; }
.icon-delete { background:#e84545; color:white; }
/* Bot√≥n panel lateral */
#openPanelBtn {
  position: fixed;
  top: 25px;
  right: 25px;
  width: 52px;
  height: 52px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  color: white;
  font-size: 28px;
  font-weight: 600;
  background: linear-gradient(135deg, #0072bb, #7cc242);
  box-shadow: 0 4px 10px rgba(0,0,0,0.20);
  display: flex;
  justify-content: center;
  align-items: center;
  transition: .15s;
  z-index: 999;
}
#openPanelBtn:hover {
  transform: scale(1.09);
}
/* Panel lateral */
#sidePanel {
  position: fixed;
  right: -400px;
  top: 0;
  width: 340px;
  height: 100vh;
  background: #ffffffee;
  backdrop-filter: blur(6px);
  box-shadow: -3px 0 10px rgba(0,0,0,.1);
  padding: 20px;
  transition: .4s;
  z-index: 1000;
}
#sidePanel.open { right: 0; }
#closePanel {
  position:absolute;
  top:12px;
  right:15px;
  font-size:22px;
  cursor:pointer;
  color:#0072bb;
  font-weight:600;
}
#sidePanel input,
#sidePanel textarea,
#sidePanel select {
  width: 100%;
  margin-bottom: 12px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}
#sidePanel button {
  width: 100%;
  padding: 12px;
  background: #0072bb;
  color: white;
  border: none;
  cursor: pointer;
  border-radius: 8px;
}
/* Modal */
#modal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,.5);
  justify-content:center;
  align-items:center;
  z-index:2000;
}
#modalContent {
  width: 360px;
  background:white;
  padding:22px;
  border-radius:12px;
}
</style>
</head>
 
 <body>
<button id="logoutBtn" class="logout-btn">‚Üê Salir</button>
 
<!-- Bot√≥n de descarga de reporte -->
<button id="downloadReportBtn" class="logout-btn" style="left:auto; right:22px; top:90px; background:#0072bb;">
  Descargar reporte
</button>
 
  <!-- üîµ NUEVO ‚Äî BOT√ìN HAMBURGUESA PARA FILTROS -->
<button id="filterMenuBtn">‚ò∞</button>
 
<!-- üîµ NUEVO ‚Äî PANEL LATERAL DE FILTROS -->
<div id="filtersPanel">
<h3>Filtros</h3>
 
    <!-- üîµ NUEVOS PERO USANDO TUS MISMOS SELECTS -->
<select id="filterType">
<option value="">Tipo</option>
<option value="implementaci√≥n">Implementaci√≥n</option>
<option value="incidente">Incidente</option>
<option value="mejora">Mejora</option>
</select>
 
    <select id="filterImpact">
<option value="">Impacto</option>
<option value="alto">Alto</option>
<option value="medio">Medio</option>
<option value="bajo">Bajo</option>
</select>
 
    <input id="filterKeyword" placeholder="Buscar..." />
</div>
<!-- Men√∫ de opciones de descarga -->
<div id="downloadMenu" 
     style="display:none; position:fixed; top:150px; right:22px; background:white;
            padding:10px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,.15); z-index:2000;">
<button id="downloadExcel" style="margin-bottom:8px; width:100%;">üìä Excel</button>
<button id="downloadPDF" style="width:100%;">üìÑ PDF</button>
</div>
 
<header class="hero">
<img src="logo-gases.png" class="hero-logo">
<div class="hero-text">
<h1>CAMINO GDC</h1>
<p>Explor√° los hitos m√°s importantes por a√±o</p>
</div>
</header>
 
<section class="main-timeline" id="timeline"></section>
<div id="yearDetailContainer"></div>
 
<button id="openPanelBtn">+</button>
 
<div id="sidePanel">
<h2>Crear / Editar Hito</h2>
<div id="closePanel">‚úñ</div>
<input id="dateInput" type="date" />
<input id="titleInput" placeholder="T√≠tulo" />
<input id="detailInput" placeholder="Detalle breve (8 palabras)" />
<textarea id="descriptionInput" placeholder="Descripci√≥n"></textarea>
<select id="typeInput">
<option value="">Tipo</option>
<option value="Implementaci√≥n">Implementaci√≥n</option>
<option value="Incidente">Incidente</option>
<option value="Mejora">Mejora</option>
</select>
<select id="impactInput">
<option value="">Impacto</option>
<option value="Alto">Alto</option>
<option value="Medio">Medio</option>
<option value="Bajo">Bajo</option>
</select>
<input id="authorInput" placeholder="Autor" />
<button id="submitHito">Guardar Hito</button>
</div>
 
<div id="modal">
<div id="modalContent">
<h2 id="modalTitle"></h2>
<p id="modalDate"></p>
<p id="modalDesc"></p>
<p id="modalExtra"></p>
</div>
</div>
 
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script>
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî FIREBASE ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
const firebaseConfig = {
  apiKey: "AIzaSyABOt5v_tBFjXttFlogHPnOY9l_T_a7g0c",
  authDomain: "camino-gdc.firebaseapp.com",
  projectId: "camino-gdc",
  storageBucket: "camino-gdc.firebasestorage.app",
  messagingSenderId: "1053392006260",
  appId: "1:1053392006260:web:8c39450408566f14987521"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CONFIG GOOGLE SHEETS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
const SHEET_ID        = "13SfGnF5EZduKG6_NjeCWPeY63uR48yEfvVTyGF6j_bA";
const API_KEY         = "AIzaSyDI7q9YVBaK24yBQtP08SU4uOJiFsXmMaQ";
const SHEET_NAME      = "Hitos";
const ROLE_SHEET_NAME = "Usuarios";
/* ‚ö†Ô∏è AQU√ç TEN√çAS %22 QUE ROMP√çA EL C√ìDIGO. LO CORRIJO A exec" */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyjthogZdAEo1Irk_Dy8cgiJyG2o4YHgdzf2hC5a-3V1A7VZOMemGa4ilvNWcp_-gSX/exec";
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî DOM ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
const filterType          = document.getElementById("filterType");
const filterImpact        = document.getElementById("filterImpact");
const filterKeyword       = document.getElementById("filterKeyword");
const openPanelBtn        = document.getElementById("openPanelBtn");
const sidePanel           = document.getElementById("sidePanel");
const closePanel          = document.getElementById("closePanel");
const submitHito          = document.getElementById("submitHito");
const timeline            = document.getElementById("timeline");
const yearDetailContainer = document.getElementById("yearDetailContainer");
const modal               = document.getElementById("modal");
const modalTitle          = document.getElementById("modalTitle");
const modalDate           = document.getElementById("modalDate");
const modalDesc           = document.getElementById("modalDesc");
const modalExtra          = document.getElementById("modalExtra");
/* Bot√≥n descarga reporte */
const downloadBtn        = document.getElementById("downloadReportBtn");
const downloadMenu       = document.getElementById("downloadMenu");
const downloadExcelBtn   = document.getElementById("downloadExcel");
const downloadPDFBtn     = document.getElementById("downloadPDF");
 
document.getElementById("logoutBtn").onclick = () => {
  auth.signOut().then(() => {
    window.location.href = "login.html";
  });
};
/* Men√∫ descarga reporte */
if (downloadBtn && downloadMenu && downloadExcelBtn && downloadPDFBtn) {
  downloadBtn.onclick = () => {
    downloadMenu.style.display = (downloadMenu.style.display === "none" || !downloadMenu.style.display)
      ? "block"
      : "none";
  };
  downloadExcelBtn.onclick = () => {
    window.location.href = SCRIPT_URL + "?action=excel";
    downloadMenu.style.display = "none";
  };
  downloadPDFBtn.onclick = () => {
    window.location.href = SCRIPT_URL + "?action=pdf";
    downloadMenu.style.display = "none";
  };
}
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ROL DESDE GOOGLE SHEETS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
async function obtenerRolUsuario(email) {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${ROLE_SHEET_NAME}?key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  if (!data.values) return null;
  const rows = data.values.slice(1);
  for (const row of rows) {
    const [correo, rol] = row;
    if (correo && correo.trim().toLowerCase() === email.toLowerCase()) {
      return (rol || "").trim().toLowerCase();
    }
  }
  return null;
}
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî AUTH ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
auth.onAuthStateChanged(async user => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }
 
  const rol = await obtenerRolUsuario(user.email);
  window.USER_ROLE = rol;
 
  if (rol !== "admin") {
    openPanelBtn.style.display = "none";
    sidePanel.style.display = "none";
  }
 
  // üî• SOLO AQU√ç cargamos todo
  await construirAnios();
  await cargarHitos();
});
  
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CREAR A√ëOS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
async function construirAnios() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  if (!data.values) return;
  const rows = data.values.slice(1);
  const yearsSet = new Set();
  rows.forEach(r => {
    const fecha = r[0];
    if (!fecha) return;
    const y = new Date(fecha).getFullYear();
    if (!isNaN(y)) yearsSet.add(y);
  });
  const years = Array.from(yearsSet).sort((a,b) => a - b);
  timeline.innerHTML = "";
  yearDetailContainer.innerHTML = "";
  years.forEach(y => {
    const node = document.createElement("div");
    node.className = "year-node";
    node.dataset.year = y;
    node.textContent = y;
    timeline.appendChild(node);
    const section = document.createElement("section");
    section.className = "year-details";
    section.id = `details-${y}`;
    section.innerHTML = `<div class="events-line"></div>`;
    yearDetailContainer.appendChild(section);
  });
  activarClicksAnios();
}
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CLICK EN A√ëOS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function activarClicksAnios() {
  const nodes   = document.querySelectorAll(".year-node");
  const details = document.querySelectorAll(".year-details");
  nodes.forEach(n => {
    n.onclick = () => {
      nodes.forEach(x => x.classList.remove("active"));
      details.forEach(d => d.classList.remove("active"));
      n.classList.add("active");
      const target = document.getElementById("details-" + n.dataset.year);
      if (target) target.classList.add("active");
    };
  });
}
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CREAR TARJETA ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function crearEvento(row) {
  const [
    fecha = "",
    titulo = "",
    detalle = "",
    descripcion = "",
    tipo = "",
    impacto = "",
    autor = "",
    id = ""
  ] = row.concat(Array(8 - row.length).fill(""));
  if (!fecha || !titulo) return;
  const y = new Date(fecha).getFullYear();
  const cont = document.getElementById("details-" + y);
  if (!cont) return;
  const el = document.createElement("div");
  el.className = "event";
  el.dataset.id = id;
  el.dataset.type = (tipo || "").toLowerCase();
  el.dataset.impact = (impacto || "").toLowerCase();
  el.dataset.key = `${fecha} ${titulo} ${detalle} ${descripcion} ${tipo} ${impacto} ${autor}`.toLowerCase();
  el.innerHTML = `
<div class="date">${fecha}</div>
<h3>${titulo}</h3>
<p>${detalle || ""}</p>
    ${window.USER_ROLE === "admin" ? `
<div class="admin-tools">
<button class="icon-btn icon-edit" data-id="${id}" title="Editar">‚úé</button>
<button class="icon-btn icon-delete" data-id="${id}" title="Eliminar">üóë</button>
</div>
    ` : ""}
  `;
  el.addEventListener("click", (e) => {
    if (e.target.classList.contains("icon-edit") ||
        e.target.classList.contains("icon-delete")) return;
    abrirModal(titulo, fecha, descripcion, tipo, impacto, autor);
  });
  if (window.USER_ROLE === "admin") {
    const editBtn   = el.querySelector(".icon-edit");
    const deleteBtn = el.querySelector(".icon-delete");
    if (editBtn) {
      editBtn.onclick = (e) => {
        e.stopPropagation();
        cargarHitoEnFormulario(row);
      };
    }
    if (deleteBtn) {
      deleteBtn.onclick = async (e) => {
        e.stopPropagation();
        if (!confirm("¬øSeguro que deseas eliminar este hito?")) return;
        await eliminarHito(id);
        location.reload();
      };
    }
  }
  cont.appendChild(el);
}
                                                                                                                                                 /* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CARGAR HITOS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
async function cargarHitos() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  if (!data.values) return;
  const rows = data.values.slice(1);
  rows.forEach(row => crearEvento(row));
  aplicarFiltros();
}
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî MODAL ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function abrirModal(t, f, d, tipo, impacto, autor) {
  modal.style.display = "flex";
  modalTitle.textContent = t;
  modalDate.textContent  = f;
  modalDesc.textContent  = d || "";
  modalExtra.innerHTML = `
<b>Tipo:</b> ${tipo}<br>
<b>Impacto:</b> ${impacto}<br>
<b>Autor:</b> ${autor}<br>
  `;
}
modal.onclick = (e) => {
  if (e.target === modal) modal.style.display = "none";
};
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî FILTROS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function aplicarFiltros() {
  const t = filterType.value.toLowerCase();
  const i = filterImpact.value.toLowerCase();
  const k = filterKeyword.value.toLowerCase();
  document.querySelectorAll(".event").forEach(ev => {
    const type   = ev.dataset.type || "";
    const impact = ev.dataset.impact || "";
    const key    = ev.dataset.key || "";
    const matchT = !t || type === t;
    const matchI = !i || impact === i;
    const matchK = !k || key.includes(k);
    ev.style.display = (matchT && matchI && matchK) ? "" : "none";
  });
}
filterType.onchange   = aplicarFiltros;
filterImpact.onchange = aplicarFiltros;
filterKeyword.oninput = aplicarFiltros;
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ABRIR / CERRAR PANEL ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
openPanelBtn.onclick = () => {
  if (window.USER_ROLE !== "admin") return;
  window.EDITING_ID = null;
  limpiarFormulario();
  sidePanel.classList.add("open");
};
closePanel.onclick = () => sidePanel.classList.remove("open");
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CARGAR EN FORMULARIO ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function cargarHitoEnFormulario(row) {
  const [
    fecha = "",
    titulo = "",
    detalle = "",
    descripcion = "",
    tipo = "",
    impacto = "",
    autor = "",
    id = ""
  ] = row;
  window.EDITING_ID = id;
  document.getElementById("dateInput").value        = fecha;
  document.getElementById("titleInput").value       = titulo;
  document.getElementById("detailInput").value      = detalle;
  document.getElementById("descriptionInput").value = descripcion;
  document.getElementById("typeInput").value        = tipo;
  document.getElementById("impactInput").value      = impacto;
  document.getElementById("authorInput").value      = autor;
  sidePanel.classList.add("open");
}
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî LIMPIAR FORMULARIO ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function limpiarFormulario() {
  document.getElementById("dateInput").value        = "";
  document.getElementById("titleInput").value       = "";
  document.getElementById("detailInput").value      = "";
  document.getElementById("descriptionInput").value = "";
  document.getElementById("typeInput").value        = "";
  document.getElementById("impactInput").value      = "";
  document.getElementById("authorInput").value      = "";
}
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî GUARDAR HITO ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
submitHito.onclick = async () => {
  if (window.USER_ROLE !== "admin") {
    alert("‚ùå No ten√©s permisos para crear/editar hitos.");
    return;
  }
  const payload = {
    id: window.EDITING_ID || "",
    fecha: document.getElementById("dateInput").value,
    titulo: document.getElementById("titleInput").value,
    detalle: document.getElementById("detailInput").value,
    descripcion: document.getElementById("descriptionInput").value,
    tipo: document.getElementById("typeInput").value,
    impacto: document.getElementById("impactInput").value,
    autor: document.getElementById("authorInput").value,
    action: window.EDITING_ID ? "update" : "add"
  };
  if (!payload.fecha || !payload.titulo) {
    alert("La fecha y el t√≠tulo son obligatorios.");
    return;
  }
  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error("Error en Apps Script");
    alert("Hito guardado ‚úî");
    window.EDITING_ID = null;
    location.reload();
  } catch (err) {
    console.error(err);
    alert("Ocurri√≥ un error guardando el hito.");
  }
};
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ELIMINAR HITO ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
async function eliminarHito(id) {
  try {
    await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify({ action: "delete", id })
    });
  } catch (err) {
    console.error(err);
    alert("Error eliminando el hito.");
  }
}
 
/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî REGISTRO SERVICE WORKER (PWA) ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker
      .register("service-worker.js")
      .then(() => console.log("Service Worker registrado ‚úî"))
      .catch(err => console.log("Error SW:", err));
  });
}
</script>
</body>
</html>
