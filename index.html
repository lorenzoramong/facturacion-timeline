<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CAMINO GDC</title>
 
<style>
  body {
    margin: 0;
    font-family: "Inter", sans-serif;
    background: #fff;
    color: #222;
  }
 
  /* ================================
     ENCABEZADO
  =================================*/
  .hero {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 60px 20px 40px;
    gap: 20px;
    background: linear-gradient(135deg, #eaf6ff, #d3f7e4);
    border-bottom: 1px solid #e3eaf0;
  }
 
  .hero-logo {
    width: 95px;
    height: 95px;
    object-fit: contain;
    animation: float 3s ease-in-out infinite;
  }
 
  @keyframes float {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
 
  .hero-text h1 {
    font-size: 2.4rem;
    font-weight: 700;
    margin: 0;
    color: #0072bb;
  }
 
  .hero-text p {
    margin: 8px 0 0;
    color: #444;
  }
 
  /* ================================
     FILTROS (SIN FILTRO DE AÑO)
  =================================*/
  .filters {
    display: flex;
    flex-direction: column;
    position: fixed;
    left: 20px;
    top: 330px; /* bajados */
    gap: 12px;
    background: #ffffffd8;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    backdrop-filter: blur(10px);
    z-index: 10;
  }
 
  .filters select,
  .filters input {
    padding: 9px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 0.95rem;
  }
 
  /* ================================
     LÍNEA PRINCIPAL DE AÑOS
  =================================*/
  .main-timeline {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 90px;
    margin: 80px auto;
    padding: 10px;
    max-width: 1100px;
    position: relative;
  }
 
  .main-timeline::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 5%;
    right: 5%;
    height: 4px;
    background: linear-gradient(90deg, #0072bb, #7cc242);
  }
 
  .year-node {
    background: #fff;
    border: 4px solid #0072bb;
    border-radius: 50%;
    width: 75px;
    height: 75px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    cursor: pointer;
    transition: .25s;
  }
 
  .year-node.active {
    background: #7cc242;
    color: #fff;
    border-color: #7cc242;
  }
 
  .year-node:hover {
    transform: scale(1.12);
    background: #0072bb;
    color: #fff;
  }
 
  /* ================================
       DETALLES DE LOS HITOS
  =================================*/
  .year-details {
    display: none;
    flex-direction: column;
    align-items: center;
    margin-top: 40px;
  }
 
  .year-details.active {
    display: flex;
    animation: fadeIn .5s;
  }
 
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
 
  .events-line {
    width: 3px;
    background: #0072bb55;
    height: 100%;
    margin-bottom: 20px;
  }
 
  .event {
    width: 310px;
    padding: 18px;
    background: #f9f9f9;
    margin: 20px 0;
    border-left: 6px solid #0072bb;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 5px 12px rgba(0,0,0,.06);
    transition: .25s;
  }
 
  .event:hover {
    transform: translateY(-4px);
  }
 
  .event .date {
    color: #7cc242;
    font-weight: 600;
  }
 
  /* ================================
        BOTÓN PANEL LATERAL
  =================================*/
  #openPanelBtn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: linear-gradient(90deg, #0072bb, #7cc242);
    color: white;
    padding: 14px 22px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    border: none;
    box-shadow: 0 4px 12px rgba(0,0,0,.2);
    z-index: 10;
  }
 
  /* ================================
        PANEL LATERAL
  =================================*/
  #sidePanel {
    position: fixed;
    right: -400px;
    top: 0;
    width: 340px;
    height: 100vh;
    background: #ffffffee;
    padding: 22px;
    box-shadow: -4px 0 14px rgba(0,0,0,.12);
    transition: .4s;
    backdrop-filter: blur(8px);
    z-index: 20;
  }
 
  #sidePanel.open {
    right: 0;
  }
 
  #sidePanel h2 {
    color: #0072bb;
    margin-bottom: 10px;
  }
 
  #sidePanel input,
  #sidePanel textarea {
    width: 100%;
    margin-bottom: 14px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 0.95rem;
  }
 
  #sidePanel button {
    width: 100%;
    padding: 12px;
    background: #0072bb;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    font-weight: 600;
  }
 
  /* ================================
        MODAL
  =================================*/
  #modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width:100%; height:100%;
    background: rgba(0,0,0,.5);
    justify-content: center;
    align-items: center;
    z-index: 30;
  }
 
  #modalContent {
    width: 360px;
    background: white;
    padding: 24px;
    border-radius: 12px;
  }
 
  #modalTitle {
    margin-top: 0;
    color: #0072bb;
  }
</style>
</head>
 
<body>
 
<!-- ENCABEZADO -->
<header class="hero">
<img src="logo-gases.png" class="hero-logo" alt="Gases del Caribe" />
<div class="hero-text">
<h1>CAMINO GDC</h1>
<p>Explorá los hitos más importantes por año</p>
</div>
</header>
 
<!-- FILTROS (SIN AÑO) -->
<div class="filters">
<select id="filterType">
<option value="">Tipo</option>
<option value="Migración">Migración</option>
<option value="Error">Error</option>
<option value="Automatización">Automatización</option>
</select>
 
  <input id="filterKeyword" placeholder="Buscar..." />
</div>
 
<!-- LÍNEA DE TIEMPO -->
<section class="main-timeline" id="timeline"></section>
 
<!-- DETALLES POR AÑO -->
<div id="yearDetailContainer"></div>
 
<!-- BOTÓN PANEL -->
<button id="openPanelBtn">+ Crear Hito</button>
 
<!-- PANEL LATERAL -->
<div id="sidePanel">
<h2>Crear Hito</h2>
 
  <input id="dateInput" type="date" />
<input id="titleInput" placeholder="Título" />
<input id="detailInput" placeholder="Detalle breve (máx. 8 palabras)" />
<textarea id="descriptionInput" placeholder="Descripción"></textarea>
<input id="typeInput" placeholder="Tipo" />
<input id="impactInput" placeholder="Impacto" />
<input id="authorInput" placeholder="Autor" />
 
  <button id="submitHito">Guardar Hito</button>
</div>
 
<!-- MODAL -->
<div id="modal">
<div id="modalContent">
<h2 id="modalTitle"></h2>
<p id="modalDate"></p>
<p id="modalDesc"></p>
<p id="modalExtra"></p>
</div>
</div>
 
<!-- =========================
     FIREBASE AUTH
========================= -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
 
<script>
const firebaseConfig = {
  apiKey: "AIzaSyABOt5v_tBFjXttFlogHPnOY9l_T_a7g0c",
  authDomain: "camino-gdc.firebaseapp.com",
  projectId: "camino-gdc",
  storageBucket: "camino-gdc.firebasestorage.app",
  messagingSenderId: "1053392006260",
  appId: "1:1053392006260:web:8c39450408566f14987521"
};
 
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
auth.onAuthStateChanged(user => {
  if (!user) window.location.href = "login.html";
});
</script>
 
<!-- =========================
     LÓGICA PRINCIPAL
========================= -->
<script>
/* GOOGLE SHEETS CONFIG */
const SHEET_ID   = "13SfGnF5EZduKG6_NjeCWPeY63uR48yEfvVTyGF6j_bA";
const API_KEY    = "AIzaSyDI7q9YVBaK24yBQtP08SU4uOJiFsXmMaQ";
const SHEET_NAME = "Hitos";
 
/* APPS SCRIPT PARA GUARDAR HITOS */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyjthogZdAEo1Irk_Dy8cgiJyG2o4YHgdzf2hC5a-3V1A7VZOMemGa4ilvNWcp_-gSX/exec";
 
/* REFERENCIAS */
const timeline = document.getElementById("timeline");
const yearDetailContainer = document.getElementById("yearDetailContainer");
 
const filterType = document.getElementById("filterType");
const filterKeyword = document.getElementById("filterKeyword");
 
const openPanelBtn = document.getElementById("openPanelBtn");
const sidePanel = document.getElementById("sidePanel");
const submitHito = document.getElementById("submitHito");
 
/* MODAL */
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalDate = document.getElementById("modalDate");
const modalDesc = document.getElementById("modalDesc");
const modalExtra = document.getElementById("modalExtra");
 
/* ============================================
   1. Construir Años (timeline + contenedores)
============================================ */
async function construirAnios() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  if (!data.values) return;
 
  const rows = data.values.slice(1);
  const yearsSet = new Set();
 
  rows.forEach(r => {
    const fecha = r[0];
    if (!fecha) return;
    yearsSet.add(new Date(fecha).getFullYear());
  });
 
  const years = Array.from(yearsSet).sort((a,b) => a-b);
 
  timeline.innerHTML = "";
  yearDetailContainer.innerHTML = "";
 
  years.forEach(year => {
    const node = document.createElement("div");
    node.className = "year-node";
    node.dataset.year = year;
    node.textContent = year;
    timeline.appendChild(node);
 
    const sec = document.createElement("section");
    sec.className = "year-details";
    sec.id = `details-${year}`;
    sec.innerHTML = `<div class="events-line"></div>`;
    yearDetailContainer.appendChild(sec);
  });
 
  activarClicksAnios();
  cargarHitos();
}
 
/* ============================================
   2. Click de año
============================================ */
function activarClicksAnios() {
  const nodes = document.querySelectorAll(".year-node");
  const details = document.querySelectorAll(".year-details");
 
  nodes.forEach(n => {
    n.onclick = () => {
      nodes.forEach(x => x.classList.remove("active"));
      details.forEach(d => d.classList.remove("active"));
 
      n.classList.add("active");
      document.getElementById(`details-${n.dataset.year}`).classList.add("active");
    };
  });
}
 
/* ============================================
   3. Cargar Hitos
============================================ */
async function cargarHitos() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  if (!data.values) return;
 
  const rows = data.values.slice(1);
 
  rows.forEach(r => {
    const [fecha, titulo, detalle, descripcion, tipo, impacto, autor] = r;
 
    if (!fecha || !titulo) return;
 
    const year = new Date(fecha).getFullYear();
    const cont = document.getElementById(`details-${year}`);
    if (!cont) return;
 
    const div = document.createElement("div");
    div.className = "event";
 
    div.dataset.tipo = (tipo || "").toLowerCase();
    div.dataset.search = `
      ${fecha} ${titulo} ${detalle} ${descripcion} ${tipo} ${impacto} ${autor}
    `.toLowerCase();
 
    div.innerHTML = `
<div class="date">${fecha}</div>
<h3>${titulo}</h3>
<p>${detalle || ""}</p>
    `;
 
    div.onclick = () => abrirModal(titulo, fecha, descripcion, tipo, impacto, autor);
 
    cont.appendChild(div);
  });
 
  aplicarFiltros();
}
 
/* ============================================
   4. Modal
============================================ */
function abrirModal(t, f, d, tipo, impacto, autor) {
  modalTitle.textContent = t;
  modalDate.textContent = f;
  modalDesc.textContent = d || "";
  modalExtra.innerHTML = `
<b>Tipo:</b> ${tipo || ""}<br>
<b>Impacto:</b> ${impacto || ""}<br>
<b>Autor:</b> ${autor || ""}<br>
  `;
  modal.style.display = "flex";
}
 
modal.onclick = e => { if (e.target === modal) modal.style.display = "none"; };
 
document.addEventListener("keydown", e => {
  if (e.key === "Escape") modal.style.display = "none";
});
 
/* ============================================
   5. Filtros (solo tipo + texto)
============================================ */
function aplicarFiltros() {
  const tipoFiltro  = filterType.value.toLowerCase();
  const textoFiltro = filterKeyword.value.toLowerCase();
 
  const eventos = document.querySelectorAll(".event");
 
  eventos.forEach(ev => {
    const tipo   = ev.dataset.tipo || "";
    const search = ev.dataset.search || "";
 
    const coincideTipo  = !tipoFiltro || tipo === tipoFiltro;
    const coincideTexto = !textoFiltro || search.includes(textoFiltro);
 
    ev.style.display = (coincideTipo && coincideTexto) ? "block" : "none";
  });
}
 
filterType.onchange = aplicarFiltros;
filterKeyword.oninput = aplicarFiltros;
 
/* ============================================
   6. Panel Lateral
============================================ */
openPanelBtn.onclick = () => sidePanel.classList.add("open");
 
document.addEventListener("keydown", e => {
  if (e.key === "Escape") sidePanel.classList.remove("open");
});
 
/* ============================================
   7. Guardar Hito (Apps Script)
============================================ */
submitHito.onclick = async () => {
  const fecha       = document.getElementById("dateInput").value;
  const titulo      = document.getElementById("titleInput").value;
  const detalle     = document.getElementById("detailInput").value;
  const descripcion = document.getElementById("descriptionInput").value;
  const tipo        = document.getElementById("typeInput").value;
  const impacto     = document.getElementById("impactInput").value;
  const autor       = document.getElementById("authorInput").value;
 
  if (!fecha || !titulo) {
    alert("La fecha y el título son obligatorios.");
    return;
  }
 
  const payload = {
    fecha,
    titulo,
    detalle,
    descripcion,
    tipo,
    impacto,
    autor
  };
 
  try {
    const res = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(payload)
    });
 
    if (!res.ok) throw new Error("No se pudo guardar");
 
    alert("Hito guardado correctamente.");
    location.reload();
  } catch (err) {
    console.error(err);
    alert("Error al guardar el hito.");
  }
};
 
/* ============================================
   8. Inicializar
============================================ */
window.onload = construirAnios;
</script>
 
</body>
</html>
